<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Young People Survey</title>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>
    <style>
    body {
        font-family: 'Lato', sans-serif;
        text-align: center;
    }
    
    div {
        text-align: left;
        width: 600px;
        height: 200px;
        margin: auto;
    }
    svg {
        alignment-baseline: middle;
        margin: 0;
    }
    p {
        padding-top: 10px;
        padding-left: 10px;
        padding-bottom: 10px;
        font-weight: bold; 
        background: lightgray;
        margin: 0;
    }
    text {
        font-size: 14px;

    }

    text.legend {
        font-size: 11px;
        alignment-baseline: middle;

    }

    </style>
</head>
<body>
    <h2>YOUNG PEOPLE SURVEY:<br>PERSONALITY TRAITS, VIEWS ON LIFE & OPINIONS</h2>
    <script>
        var width = 500, height = 300;
        var surveyStatementDetails, rawData;
        var horizontalAgreeScale = d3.scaleLinear().domain([0,100]).range([300, 570]);
        var horizontalDisagreeScale = d3.scaleLinear().domain([0,100]).range([30,300]);
        var verticalScale = d3.scaleLinear().domain([0,1]).range([40, 121]);
        
        d3.queue()
            .defer(d3.csv, "columns.csv")
            .defer(d3.csv, "responseAgreeDisagree.csv")
            .await(process);
                
        function toPercentage(decimalString) {
            return Math.round(parseFloat(decimalString)*100);
        }

        function process(error, colData, surveyData) {
                surveyStatementDetails = colData;
                rawData = surveyData;
                
                // City Agree & Village Agree           
                surveyStatementDetails.forEach(function(statement, i) {
                    d3.select("body").append("div")
                        .append("p")
                        .text(statement.SurveyStatement)
                        .select(function(){ return this.parentNode; })
                        .append("svg")
                            .attr("width", "600")
                            .attr("height", "161")

                        .append("text")
                        .attr("x", 0)
                        .attr("y", verticalScale(0)/2)
                        .style("fill", "black")
                        .text("City-Dweller")    
                        .select(function(){ return this.parentNode; })
                        
                        .append("text")
                        .attr("x", 0)
                        .attr("y", verticalScale(1)-25)
                        .style("fill", "black")
                        .text("Village-Dweller")    
                        .select(function(){ return this.parentNode; })

                        .append("circle")
                        .attr("cx", "540")
                        .attr("cy", "15 ")
                        .attr("r", "5")
                        .style("fill", "orange")
                        .select(function(){ return this.parentNode; })

                        .append("text")
                        .attr("class", "legend")
                        .attr("x", "550")
                        .attr("y", "15")
                        .style("fill", "black")
                        .text("Disagree")    
                        .select(function(){ return this.parentNode; })
                        
                        .append("circle")
                        .attr("cx", "540")
                        .attr("cy", "30")
                        .attr("r", "5")
                        .style("fill", "green")
                        .select(function(){ return this.parentNode; })

                        .append("text")
                        .attr("class", "legend")
                        .attr("x", "550")
                        .attr("y", "30")
                        .style("fill", "black")
                        .text("Agree")    
                        .select(function(){ return this.parentNode; })


                        .append("line")
                        .attr("x1", 300)
                        .attr("y1", verticalScale(0))
                        .attr("x2", horizontalAgreeScale(toPercentage(rawData[i].cityAgreePercent)))
                        .attr("y2", verticalScale(0))
                        .style("stroke", "grey")
                        .style("opacity", .5)
                        .style("stroke-width", 7)
                        .select(function() { return this.parentNode; })
                        
                        .append("line")
                        .attr("x1", horizontalDisagreeScale(0)+(300-horizontalDisagreeScale(toPercentage(rawData[i].cityDisPercent))))
                        .attr("y1", verticalScale(0))
                        .attr("x2", 300)
                        .attr("y2", verticalScale(0))
                        .style("stroke", "grey")
                        .style("opacity", .5)
                        .style("stroke-width", 7)
                        .select(function() { return this.parentNode; })
                        
                        .append("circle")
                        .attr("cx", horizontalAgreeScale(toPercentage(rawData[i].cityAgreePercent))+20)
                        .attr("cy", verticalScale(0))
                        .attr("r", "20")
                        .style("fill", "green")
                        .select(function() { return this.parentNode; })
                        
                        .append("text")
                        .attr("x", horizontalAgreeScale(toPercentage(rawData[i].cityAgreePercent))+20)
                        .attr("y", verticalScale(0))
                        .attr("text-anchor", "middle")
                        .attr("alignment-baseline", "middle")
                        .style("fill", "white")
                        .text(toPercentage(rawData[i].cityAgreePercent)+ "%")
                        .select(function() { return this.parentNode; })

                        .append("circle")
                        .attr("cx", horizontalDisagreeScale(0)+(300-horizontalDisagreeScale(toPercentage(rawData[i].cityDisPercent)))-20)
                        .attr("cy", verticalScale(0))
                        .attr("r", "20")
                        .style("fill", "orange")
                        .select(function() { return this.parentNode; })
                        
                        .append("text")
                        .attr("x", horizontalDisagreeScale(0)+(300-horizontalDisagreeScale(toPercentage(rawData[i].cityDisPercent)))-20)
                        .attr("y", verticalScale(0))
                        .attr("text-anchor", "middle")
                        .attr("alignment-baseline", "middle")
                        .style("fill", "white")
                        .text(toPercentage(rawData[i].cityDisPercent)+ "%")
                        .select(function() { return this.parentNode; })

                        .append("line")
                        .attr("x1", 300)
                        .attr("y1", verticalScale(1))
                        .attr("x2", horizontalAgreeScale(toPercentage(rawData[i].villageAgreePercent)))
                        .attr("y2", verticalScale(1))
                        .style("stroke", "grey")
                        .style("opacity", .5)
                        .style("stroke-width", 7)
                        .select(function() { return this.parentNode; })

                        .append("line")
                        .attr("x1", horizontalDisagreeScale(0)+(300-horizontalDisagreeScale(toPercentage(rawData[i].villageDisPercent))))
                        .attr("y1", verticalScale(1))
                        .attr("x2", 300)
                        .attr("y2", verticalScale(1))
                        .style("stroke", "grey")
                        .style("opacity", .5)
                        .style("stroke-width", 7)
                        .select(function() { return this.parentNode; })

                        .append("circle")
                        .attr("cx", horizontalAgreeScale(toPercentage(rawData[i].villageAgreePercent))+20)
                        .attr("cy", verticalScale(1))
                        .attr("r", "20")
                        .style("fill", "green")
                        .select(function() { return this.parentNode; })

                        .append("text")
                        .attr("x", horizontalAgreeScale(toPercentage(rawData[i].villageAgreePercent))+20)
                        .attr("y", verticalScale(1))
                        .attr("text-anchor", "middle")
                        .attr("alignment-baseline", "middle")
                        .style("fill", "white")
                        .text(toPercentage(rawData[i].villageAgreePercent)+ "%")
                        .select(function() { return this.parentNode; })

                        .append("circle")
                        .attr("cx", horizontalDisagreeScale(0)+(300-horizontalDisagreeScale(toPercentage(rawData[i].villageDisPercent)))-20)
                        .attr("cy", verticalScale(1))
                        .attr("r", "20")
                        .style("fill", "orange")
                        .select(function() { return this.parentNode; })

                        .append("text")
                        .attr("x", horizontalDisagreeScale(0)+(300-horizontalDisagreeScale(toPercentage(rawData[i].villageDisPercent)))-20)
                        .attr("y", verticalScale(1))
                        .attr("text-anchor", "middle")
                        .attr("alignment-baseline", "middle")
                        .style("fill", "white")
                        .text(toPercentage(rawData[i].villageDisPercent)+ "%")
                        .select(function() { return this.parentNode; })

                        .append("line")
                        .attr("x1", horizontalAgreeScale(0))
                        .attr("y1", 5)
                        .attr("x2", horizontalAgreeScale(0))
                        .attr("y2", 156)
                        .style("stroke", "grey")
                        .style("stroke-width", 1)
                        .style("stroke-dasharray", "5,5");
                        

                });
        }

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
        .append("image")
            .attr("id", "woman")
            .attr("xlink:href", "imgs/woman-dialog-no-background.png")
            .attr("width", width/2)
            .attr("height", height);
        

        svg = d3.select("svg");

        svg.append("image")
            .attr("id", "man")
            .attr("xlink:href", "imgs/man-dialog-no-background.png")
            .attr("x", width/2)
            .attr("y", 0)
            .attr("height", height);

        svg.append("line")
            .attr("x1", 0)
            .attr("y1", height)
            .attr("x2", width)
            .attr("y2", height)
            .style("stroke-width", 2)
            .style("stroke", "grey");

    
        svg.select("#woman")
            .transition()
            .delay(500)
            .attr("transform", "translate(40)");

        svg.select("#man")
            .transition()
            .delay(1000)
            .attr("transform", "translate(-40)")
            .style("opacity", 0.85);

    </script>
</body>
</html>
